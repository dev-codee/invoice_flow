{% extends 'base.html' %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<div class="page-header">
  <div class="page-header-left">
    <div style="display:flex;align-items:center;gap:12px;">
      <a href="{% url 'recurring:list' %}" class="btn-icon" style="width:32px;height:32px;flex-shrink:0;text-decoration:none;"><i class="bi bi-arrow-left"></i></a>
      <div>
        <h1 class="page-title" style="margin-bottom:0;">{{ title }}</h1>
        <p class="page-subtitle" style="margin:0;">Configure a billing schedule using a draft invoice as template</p>
      </div>
    </div>
  </div>
</div>

<div style="display:grid;grid-template-columns:1fr 300px;gap:20px;max-width:860px;align-items:start;">
  <div class="card">
    <div class="card-header"><h3 class="card-header-title">Schedule Settings</h3></div>
    <div class="card-body">
      <form method="post">
        {% csrf_token %}
        <div style="display:grid;gap:14px;">
          <div>
            <label class="form-label">Template Invoice <span style="color:var(--text-muted);font-weight:400;">(must be a draft)</span></label>
            {{ form.template_invoice }}
            {% if form.template_invoice.errors %}<div style="color:#ef4444;font-size:11.5px;margin-top:4px;">{{ form.template_invoice.errors.0 }}</div>{% endif %}
            <p style="font-size:11.5px;color:var(--text-muted);margin:5px 0 0;">Only Draft invoices available. The draft will be copied each billing cycle.</p>
          </div>
          <div>
            <label class="form-label">Frequency</label>
            {{ form.frequency }}
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
            <div>
              <label class="form-label">Start Date</label>
              {{ form.start_date }}
            </div>
            <div>
              <label class="form-label">First Invoice Date</label>
              {{ form.next_run_date }}
            </div>
            <div>
              <label class="form-label">End Date <span style="font-weight:400;color:var(--text-muted);">(optional)</span></label>
              {{ form.end_date }}
            </div>
            <div>
              <label class="form-label">Max Invoices <span style="font-weight:400;color:var(--text-muted);">(optional)</span></label>
              {{ form.max_occurrences }}
            </div>
          </div>
          <div style="display:flex;align-items:center;gap:10px;padding:12px;background:var(--brand-50);border-radius:8px;border:1px solid var(--brand-100);">
            {{ form.is_active }}
            <label style="font-size:13.5px;font-weight:600;color:var(--brand-700);cursor:pointer;margin:0;">Activate schedule immediately</label>
          </div>
        </div>
        <div style="display:flex;gap:10px;margin-top:20px;">
          <button type="submit" class="btn btn-primary"><i class="bi bi-check2"></i> Save Schedule</button>
          <a href="{% url 'recurring:list' %}" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <div style="font-size:10.5px;font-weight:700;letter-spacing:0.8px;text-transform:uppercase;color:var(--text-muted);margin-bottom:14px;">How Recurring Works</div>
      <div style="display:flex;flex-direction:column;gap:12px;">
        <div style="display:flex;gap:10px;align-items:flex-start;">
          <div style="width:24px;height:24px;border-radius:50%;background:var(--brand-600);color:#fff;font-size:11px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;">1</div>
          <div style="font-size:12.5px;color:var(--text-secondary);">Create a <strong>Draft invoice</strong> with the line items you want to repeat.</div>
        </div>
        <div style="display:flex;gap:10px;align-items:flex-start;">
          <div style="width:24px;height:24px;border-radius:50%;background:var(--brand-600);color:#fff;font-size:11px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;">2</div>
          <div style="font-size:12.5px;color:var(--text-secondary);">Set the frequency and date range for automatic billing.</div>
        </div>
        <div style="display:flex;gap:10px;align-items:flex-start;">
          <div style="width:24px;height:24px;border-radius:50%;background:var(--brand-600);color:#fff;font-size:11px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;">3</div>
          <div style="font-size:12.5px;color:var(--text-secondary);">Celery copies and sends the invoice automatically on each cycle.</div>
        </div>
      </div>
      <div style="margin-top:16px;padding:10px 12px;background:#fffbeb;border-radius:8px;border:1px solid #fde68a;">
        <div style="font-size:12px;color:#92400e;"><i class="bi bi-info-circle me-1"></i>Requires Redis + Celery worker to be running.</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
