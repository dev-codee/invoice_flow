{% extends 'base.html' %}
{% block title %}Recurring Invoices{% endblock %}
{% block content %}
<div class="page-header">
  <div class="page-header-left">
    <h1 class="page-title">Recurring Invoices</h1>
    <p class="page-subtitle">Automate billing for regular clients â€” invoices are generated on schedule</p>
  </div>
  <div class="page-header-actions">
    <a href="{% url 'recurring:create' %}" class="btn btn-primary"><i class="bi bi-plus"></i> New Schedule</a>
  </div>
</div>

<div class="data-table-wrap">
  <table class="data-table">
    <thead><tr>
      <th>Template Invoice</th>
      <th>Client</th>
      <th>Frequency</th>
      <th>Next Run</th>
      <th>Sent</th>
      <th>Status</th>
      <th class="col-actions">Actions</th>
    </tr></thead>
    <tbody>
      {% for s in schedules %}
      <tr>
        <td>
          <a href="{% url 'invoices:detail' s.template_invoice.pk %}" class="col-primary" style="font-weight:700;">
            {{ s.template_invoice.invoice_number }}
          </a>
        </td>
        <td>
          <div style="display:flex;align-items:center;gap:8px;">
            <div style="width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#818cf8,#6366f1);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff;flex-shrink:0;">{{ s.template_invoice.client.name|first|upper }}</div>
            {{ s.template_invoice.client.name }}
          </div>
        </td>
        <td>
          <span class="tag">{{ s.get_frequency_display }}</span>
        </td>
        <td class="col-muted">{{ s.next_run_date|date:"M d, Y" }}</td>
        <td class="col-muted">{{ s.occurrences_sent }}{% if s.max_occurrences %} / {{ s.max_occurrences }}{% endif %}</td>
        <td>
          {% if s.is_active %}
          <span class="status-badge status-paid">Active</span>
          {% else %}
          <span class="status-badge status-cancelled">Paused</span>
          {% endif %}
        </td>
        <td class="col-actions">
          <div class="row-actions">
            <a href="{% url 'recurring:toggle' s.pk %}"
               class="btn-row"
               title="{% if s.is_active %}Pause{% else %}Activate{% endif %}"
               onclick="return confirm('{% if s.is_active %}Pause this schedule?{% else %}Activate this schedule?{% endif %}')">
              <i class="bi bi-{% if s.is_active %}pause-circle{% else %}play-circle{% endif %}"></i>
            </a>
            <a href="{% url 'recurring:delete' s.pk %}" class="btn-row btn-row-danger" title="Delete">
              <i class="bi bi-trash"></i>
            </a>
          </div>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="7">
        <div class="empty-state">
          <i class="bi bi-arrow-repeat empty-state-icon"></i>
          <h3>No recurring schedules yet</h3>
          <p>Set up automatic billing for clients you invoice regularly</p>
          <a href="{% url 'recurring:create' %}" class="btn btn-primary">Create Schedule</a>
        </div>
      </td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{# Info banner if no draft invoices exist #}
{% if not schedules %}
<div style="margin-top:16px;padding:14px 18px;background:#eff6ff;border:1px solid #bfdbfe;border-radius:10px;display:flex;align-items:center;gap:12px;">
  <i class="bi bi-info-circle" style="color:#2563eb;font-size:18px;flex-shrink:0;"></i>
  <div style="font-size:13px;color:#1e40af;">
    <strong>How it works:</strong> Recurring invoices use a Draft invoice as a template. Create a draft invoice first, then set up a schedule here. Celery will auto-generate and send invoices on the configured frequency.
  </div>
</div>
{% endif %}
{% endblock %}
